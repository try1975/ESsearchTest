Q: Что за номер нормализатора в запросе, как он используется и почему он один: насколько я понял, сейчас есть отдельные нормализаторы по лек.формам, упаковке и дозировке? Или можно сделать такой, который правильно их применяет в комплексе?
A: Имя нормализатора - специфический набор нормализаторов по лек.формам, упаковке и дозировке, объединенный одним именем. Например, если нужно создать специальный нормализатор по лек.формам, создаем POST api/pharmacy/normalizers/lekForm/Name01, теперь, при указании в поиске этого нормализатора, он будет использоваться, а остальные нормализаторы будут взяты по умолчанию. Если нужен ещё и специальный нормализатор, например по упаковке, создаем его с тем же именем POST api/pharmacy/normalizers/upak/Name01. Теперь при поиске, при указании имени нормализатора, будут использовать два специальных нормализатора и нормализатор дозировки по умолчанию
  
Q: Ещё можно поподробнее про нормализаторы? Я догадываюсь, что означают query, rate и regexp, но хотелось бы хотя бы краткого описания с указанием на особенности, если таковые есть.
A: Нормализатор лек.форм  "Таблетки": {"query": ["таб* тб тбл"], "regexp": ["\\bтаб[.летк]*", "\\bтб[.л]*"]}. regexp - массив регулярных выражений(.NET Framework диалект),
query - массив выражений для поиска, из которых будут сформированы необходимые запросы к ElasticSearch (в каждом нормализаторе свои правила формирования запросов)
Нормализатор упаковки устроен аналогично. Элемент нормализатора дозировки "мкг": {"Mutates": [{"Rate": 1.0,"query": "{0}мкг"},{"Rate": 1.0,"query": "{0} мкг"},{"Rate": 0.001,"query":"{0}мг"},{"Rate": 0.001,"query": "{0} мг"}],"regexp": ["\\s([0-9.,]+)\\s*мкг*"]}. Элемент Mutates кроме поискового выражения query содержит коэффициент пересчета Rate от найденной величины в другие единицы измерения. 

Q: Какой диалект regexp'ов используется?
A: .NET Framework диалект: http://download.microsoft.com/download/D/2/4/D240EBF6-A9BA-4E4F-A63F-AEB6DA0B921C/Regular%20expressions%20quick%20reference.pdf https://msdn.microsoft.com/ru-ru/library/az24scfc(v=vs.110).aspx


Q: Как применяются regexp'ы: влияет ли на результат порядок их указания в нормализаторе?
A: В нормализаторах на данный момент к строке для нормализации применяются regexp в порядке, указанном в нормализаторе. Если regexp сработал, дальнейшая проверка прекращается. То есть порядок regexp в нормализаторе существенно влияет на результат. Более специфические выражения должны быть расположены в начале списка.

Q: Как можно настроить поиск (на примере дозировок): 1. по дозировкам вида {что-то}/{что-то другое}, для корректной нормализации нужно будет указать все возможные комбинации?
A: На данный момент такая возможность находится в разработке и ещё не реализована. С удовольствием выслушаем ваши соображения. Мне кажется интересной применение возможности поиска с указанием нормализованных параметров поиска(вы говорили, что у вас есть массив информации, разбитый по лек.формам и тд) Посмотрите описание поиска http://144.76.3.11:52620/Help/Api/GET-api-pharmacy-contents_text_firstWords_lekForm_upak_doz_dozEd_normNumber_source Можно указать, например, что вы ищете именно дозировку 5мкг (&doz=5&dozEd=мкг) - в таком случае будут использованы поисковые выражения именно для дозировки 5мкг

Q: Как можно настроить поиск (на примере дозировок): 2. по отношениям (Rate) тоже надо будет указывать все интересующие возможные пересчёты?
A: Да, все пересчеты указывать обязательно. И дело не только в коэффициентах, а в выражении query, так как фантазия людей, публикующих данных очень многообразна, хоть и конечна

Q: Как можно настроить поиск (на примере дозировок): 3. что делать с составными препаратами, у которых дозировка может указываться в виде 10 + 20 мг, а может 20 мг + 100 мкг?
A: На данный момент такая возможность находится в разработке и ещё не реализована. Мы исследуем возможность определять несколько дозировок как с помощью regexp так и опираясь на справочник лекарственных средств и с помощью методов машинного обучения (txt2vec).

Q:Как добавить собственный нормализатор по единичным контейнерам (ампула, флакон, пакетик и т.п.)? И как сделать так, чтобы он не конфликтовал с дозировкой: например, может быть дозировка 10 мг в пакетиках по 5 г?
A: На данный момент такая возможность находится в разработке и ещё не реализована. Мы исследуем возможность определять несколько дозировок как с помощью regexp так и опираясь на справочник лекарственных средств и с помощью методов машинного обучения (txt2vec).


Общая информация: мы проводим исследования на предмет использования справочника лекарственных средств, как источника данных для нормализации и обогащения, также тестируются разные конвееры обработки данных, позволяющие улучшить поиск(очистка от незначащих символов). Исследуется результаты применения к собранному массиву данных (аптеки и госзакупки) алгоритма машинного обучения  txt2vec для улучшения результатов поиска.